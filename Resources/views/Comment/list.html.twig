{% extends 'IcapPortfolioBundle::layout.html.twig' %}

{% block content_title %}
    {{ 'portfolio_exchange_space'|trans({}, 'icap_portfolio') }}
{% endblock %}

{% block breadcrumb %}
    {{
        macros.breadcrumbs([
            {
                'icon': 'fa fa-list-alt',
                'name': 'my_portfolios'|trans({}, 'platform'),
                'href': path('icap_portfolio_list')
            },
            {
                'icon': 'fa fa-list-alt',
                'name': 'portfolio_exchange_space'|trans({}, 'icap_portfolio'),
                'href': ''
            }
        ])
    }}
{% endblock %}

{% block content_body %}
    <div data-ng-app="commentsApp" data-ng-strict-di>
        <div class="portfolios-container col-lg-3">
            <div class="title-container">
                <p class="lead text-center">{{ 'portfolios'|trans({}, 'icap_portfolio') }}</p>
            </div>
            <div class="portfolio-container loading" data-ng-class="{'loading': !portfolios.$resolved}" data-ng-init="init()">
                <div class="media portfolio ng-cloak" role="button" data-ng-repeat="portfolio in portfolios"
                     data-ng-class="{'unread': 0 < portfolio.unreadComments, 'active': selectedPortfolio == portfolio.id}"
                     data-ng-click="clickOnPortolio(portfolio.id)" data-ng-show="portfolios.$resolved">
                    <div class="media-body">
                        <h5 class="media-heading">{% verbatim %}{{ portfolio.title }}<span data-ng-show="0 < portfolio.unreadComments" class="badge pull-right">{{ portfolio.unreadComments }}</span>{% endverbatim %}</h5>
                    </div>
                </div>
            </div>
        </div>

        <div class="comments-container col-lg-9">
            <div class="title-container">
                <p class="lead text-center">{{ 'portfolios_comments'|trans({}, 'icap_portfolio') }}</p>
            </div>
            <div class="comment-container loading" data-ng-class="{'loading': !comments.$resolved}" data-ng-init="getComments(selectedPortfolio)">
                <div class="media comment ng-cloak" data-ng-repeat="comment in comments" data-ng-show="comments.$resolved">
                    {% verbatim %}
                    <a class="pull-left" href="#">
                        <img class="media-object" data-src="holder.js/64x64" alt="64x64" style="width: 32px; height: 32px;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAACqUlEQVR4Xu2Y60tiURTFl48STFJMwkQjUTDtixq+Av93P6iBJFTgg1JL8QWBGT4QfDX7gDIyNE3nEBO6D0Rh9+5z9rprr19dTa/XW2KHl4YFYAfwCHAG7HAGgkOQKcAUYAowBZgCO6wAY5AxyBhkDDIGdxgC/M8QY5AxyBhkDDIGGYM7rIAyBgeDAYrFIkajEYxGIwKBAA4PDzckpd+322243W54PJ5P5f6Omh9tqiTAfD5HNpuFVqvFyckJms0m9vf3EY/H1/u9vb0hn89jsVj8kwDfUfNviisJ8PLygru7O4TDYVgsFtDh9Xo9NBrNes9cLgeTybThgKenJ1SrVXGf1WoVDup2u4jFYhiPx1I1P7XVBxcoCVCr1UBfTqcTrVYLe3t7OD8/x/HxsdiOPqNGo9Eo0un02gHkBhJmuVzC7/fj5uYGXq8XZ2dnop5Mzf8iwMPDAxqNBmw2GxwOBx4fHzGdTpFMJkVzNB7UGAmSSqU2RoDmnETQ6XQiOyKRiHCOSk0ZEZQcUKlU8Pz8LA5vNptRr9eFCJQBFHq//szG5eWlGA1ywOnpqQhBapoWPfl+vw+fzweXyyU+U635VRGUBOh0OigUCggGg8IFK/teXV3h/v4ew+Hwj/OQU4gUq/w4ODgQrkkkEmKEVGp+tXm6XkkAOngmk4HBYBAjQA6gEKRmyOL05GnR99vbW9jtdjEGdP319bUIR8oA+pnG5OLiQoghU5OElFlKAtCGr6+vKJfLmEwm64aosd/XbDbbyIBSqSSeNKU+HXzlnFAohKOjI6maMs0rO0B20590n7IDflIzMmdhAfiNEL8R4jdC/EZIJj235R6mAFOAKcAUYApsS6LL9MEUYAowBZgCTAGZ9NyWe5gCTAGmAFOAKbAtiS7TB1Ng1ynwDkxRe58vH3FfAAAAAElFTkSuQmCC">
                    </a>
                    <div class="media-body">
                        <small class="pull-right time"><i class="fa fa-calendar"></i> {{ comment.date }}</small>
                        <h5 class="media-heading">{{ comment.user }}</h5>
                        <small class="col-lg-10" data-ng-bind-html="comment.message | trustAsHtml"></small>
                    </div>
                    {% endverbatim %}
                </div>
            </div>
            <form>
                <div class="send-container">
                    <textarea ui-tinymce class="form-control send-comment" rows="3" name="comment" data-ng-model="comment"></textarea>
                </div>
                <div class="btn-panel">
                    <button type="button" class="btn btn-sm btn-primary pull-right">{{ 'comment_send'|trans({}, 'icap_portfolio') }}</button>
                </div>
            </form>
        </div>
    </div>

{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    {% stylesheets debug=false filter='lessphp, cssmin'  output='css/icapportfolio/comments.css'
      "@IcapPortfolioBundle/Resources/views/less/comments.less"
    %}
        <link rel="stylesheet" href="{{ asset_url }}" screen="media" />
    {% endstylesheets %}
{% endblock %}

{% block javascripts %}
    {{ parent() }}

    <script type="text/javascript">
        'use strict';
        (function() {
            window.currentPortfolio = {{ portfolioId }};
            window.assetPath        = "{{ asset('') }}";
        })();
    </script>
    <script type="text/javascript" src="{{ asset('bundles/stfalcontinymce/vendor/tinymce/tinymce.jquery.min.js') }}"></script>
    <script type="text/javascript" src="{{ asset('bundles/stfalcontinymce/vendor/tinymce/jquery.tinymce.min.js') }}"></script>
    <script type="text/javascript" src="{{ asset('bundles/clarolinecore/js/tinymce/tinymce.js') }}"></script>

    {% javascripts debug=true filter='jsmin' output='js/portfolio/angular.js'
        '@IcapPortfolioBundle/Resources/public/js/vendor/angular/angular.min.js'
        '@IcapPortfolioBundle/Resources/public/js/vendor/angular/angular-resource.min.js'
        '@IcapPortfolioBundle/Resources/public/js/vendor/angular/angular-sanitize.min.js'
        '@IcapPortfolioBundle/Resources/public/js/vendor/angular/angular-animate.min.js'
    %}
        <script type="text/javascript" src="{{ asset_url }}"></script>
    {% endjavascripts %}

    <script type="text/javascript" src="{{ asset('bundles/icapportfolio/js/vendor/angular-ui/ui-tinymce/tinymce.js') }}"></script>

    <script type="text/javascript" src="{{ url('bazinga_exposetranslation_js', { 'domain_name': 'icap_portfolio' }) }}"></script>

    <script type="text/javascript" src="{{ asset('bundles/icapportfolio/js/utils/Array.js') }}"></script>

    <script type="text/javascript" src="{{ asset('bundles/icapportfolio/js/comments/commentsApp.js') }}"></script>

    <script type="text/javascript" src="{{ asset('bundles/icapportfolio/js/comments/controllers/portfoliosController.js') }}"></script>
    <script type="text/javascript" src="{{ asset('bundles/icapportfolio/js/comments/controllers/commentsController.js') }}"></script>

    <script type="text/javascript" src="{{ asset('bundles/icapportfolio/js/comments/directives/portfoliosDirective.js') }}"></script>
    <script type="text/javascript" src="{{ asset('bundles/icapportfolio/js/comments/directives/commentsDirective.js') }}"></script>

    <script type="text/javascript" src="{{ asset('bundles/icapportfolio/js/comments/services/portfolioManager.js') }}"></script>

    <script type="text/javascript" src="{{ asset('bundles/icapportfolio/js/modules/trustAsHtml.js') }}"></script>
    <script type="text/javascript" src="{{ asset('bundles/icapportfolio/js/modules/translation.js') }}"></script>
{% endblock %}
